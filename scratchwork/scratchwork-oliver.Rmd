---
title: "scratchwork oliver"
author: "Oliver Baldwin Edwards, Leah Johnson, Adi Arifovic"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    fig_height: 2.7
    fig_width: 5
  html_document:
    fig_height: 3
    fig_width: 5
  word_document:
    fig_height: 3
    fig_width: 5
---

```{r, setup, include=FALSE}
library(mdsr)   
library(ggplot2)
library(mosaic)
library(knitr)
library(tidyverse)
library(dplyr)
library(GGally)
library(kableExtra)
library(DAAG)
library(Rfit)
library(leaps)
library(gam)
# Load additional packages here 
knitr::opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
```

# Predicting Hurricane Deaths
Group 2: Oliver Baldwin Edwards, Leah Johnson, Adi Arifovic 

*table of contents here*

## Purpose

We hope to predict the number of hurricane deaths based on variables such as maximum sustained windspeed, atmospheric pressure, and property damage from a dataset containing data on 94 named hurricanes that made landfall in the US mainland from 1950 through 2012. We would expect the number of deaths to increase as the maximum sustained windspeed and property damage increases, since it would make sense for more destructive hurricanes to also be more deadly.

## Data
### Source

We plan to use the dataset "hurricNamed" from the "DAAG" R package containing data on 94 named hurricanes that made landfall in the US mainland from 1950 through 2012. It contains information on the number of deaths, the name of the hurricane, the year of the hurricane, the damage caused by the hurricane, etc. The data is sourced from multiple places and was used in a research paper claiming that hurricanes with female names did more human damage (after adjusting for the severity of the storm) than those with male names. Therefore, the data seems fairly reliable.

### Response Variables 

Our response variable is the number of deaths that occurred due to a hurricane. The units are number of human deaths. We observe that the range of deaths are from 0 to 1836. 

### Explanatory Variables

The explanatory variables we will examine are LF.WindsMPH, LF.PressureMB, LF.times, BaseDam2014, NDAM2014, and deaths.

\begin{enumerate}
\item LF.WindsMPH describes the maximum sustained windspeed for each hurricane in miles per hour
\item LF.PressureMB describes the atmospheric pressure at landfall in millibars
\item LF.times describes the number of times the hurricane made landfall 
\item BaseDam2014 describes the property damage caused by the hurricane in millions of 2014 US dollars
\item NDAM2014 describes the amount of damage the hurricane caused had it appeared in 2014 (no units given)
\item deaths describes the number of human deaths the hurricane caused
\end{enumerate}

```{r}
# load in full dataset
full_hurricane_df <- hurricNamed
glimpse(full_hurricane_df)

# remove non numeric and BaseDamage for ggpairs call
hurricane_numeric <- full_hurricane_df %>% 
  select(-c(Name, AffectedStates, firstLF, mf, BaseDamage, Year))

# removing death outlier
hurricane_death_outlier <- hurricane_numeric %>% 
  filter(deaths != 1836)

# applying a log transformation to deaths
hurricane_logdeaths <- hurricane_numeric %>% 
  mutate(log_deaths = ifelse(deaths == 0, 0, log(deaths))) %>% 
  select(-deaths)
```

## Exploratory Data Analysis

GGpairs calls
```{r}
ggpairs(hurricane_numeric)
```
talk about ggpairs here and how deaths looks bad

now we try log transformation on deaths:
```{r}
ggpairs(hurricane_logdeaths)
```
talk about above ggpairs calls here




## correlation test?
one of the following tests / corresponding CI 
ADI
binomial test
fisher's sign test
wilcoxon signed rank test
permutation/randomization test
kendalls tau or spearman's correlation test ADI

Put a sentence explaining that we want kendalls over spearmans since more robust
setup hypothesis test for posstivie association $\tau >0$
```{r}
# associated
cor.test(x=hurricane_logdeaths$NDAM2014, y=hurricane_logdeaths$log_deaths, method="kendall")

cor.test(x=hurricane_logdeaths$LF.times, y=hurricane_logdeaths$log_deaths, method="kendall")

cor.test(x=hurricane_logdeaths$LF.PressureMB, y=hurricane_logdeaths$log_deaths, method="kendall")


cor(x=hurricane_logdeaths$NDAM2014, y=hurricane_logdeaths$log_deaths, method="kendall")
```
low pvalue so reject the null, therefore they are positively associated

## Kolmogorov Smirnov Test
kolmogorov smirnov test (with empirical CDF(s) plotted) LEAH

## Kernel Density Estimation
kernel density estimation (not smoothing related) LEAH

## OLS multiple linear regression
OLS multiple linear regression (for comparison purposes) OLIVER
```{r}
# different models to predict log deaths
pressure_windspeed <- msummary(lm(log_deaths ~ LF.PressureMB + LF.WindsMPH, 
                                  data = hurricane_logdeaths)) ;pressure_windspeed

pressure_ndam <- msummary(lm(log_deaths ~ LF.PressureMB + NDAM2014, 
                                  data = hurricane_logdeaths)) ;pressure_ndam

pressure_basedam <- msummary(lm(log_deaths ~ LF.PressureMB + BaseDam2014, 
                                  data = hurricane_logdeaths)) ;pressure_basedam

wind_basedam <- msummary(lm(log_deaths ~ LF.WindsMPH + BaseDam2014, 
                            data = hurricane_logdeaths)) ;wind_basedam

wind_ndam <- msummary(lm(log_deaths ~ LF.WindsMPH + NDAM2014, 
                            data = hurricane_logdeaths)) ;wind_ndam

```
regsubsets
```{r}
test <- regsubsets(log_deaths ~ ., data=hurricane_logdeaths, nbest=3)
summary(test)

best_1pred <-  msummary(lm(log_deaths ~  NDAM2014, 
                            data = hurricane_logdeaths)) ;best_1pred

best_2pred <-  lm(log_deaths ~  NDAM2014 + LF.PressureMB, 
                            data = hurricane_logdeaths) ;best_2pred

best_3pred <-  lm(log_deaths ~  NDAM2014 + LF.PressureMB + LF.WindsMPH,
                            data = hurricane_logdeaths) ;best_3pred

# so stick with 2 predictor model
anova(best_2pred, best_3pred)

best_4pred <-  msummary(lm(log_deaths ~  NDAM2014 + LF.PressureMB + LF.WindsMPH
                           + BaseDam2014, data = hurricane_logdeaths)) ;best_4pred

full_model <- msummary(lm(log_deaths ~  NDAM2014 + LF.PressureMB + LF.WindsMPH
                           + BaseDam2014 + LF.times,
                          data = hurricane_logdeaths)) ;full_model
```

## JHM Multiple Regression

```{r}
best_2pred_rank <-  rfit(log_deaths ~  NDAM2014 + LF.PressureMB, 
                            data = hurricane_logdeaths) ;msummary(best_2pred_rank)

other_2pred_rank <-  rfit(log_deaths ~  BaseDam2014 + LF.PressureMB, 
                            data = hurricane_logdeaths) ;msummary(other_2pred_rank)

best_3pred_rank <-  rfit(log_deaths ~  NDAM2014 + LF.PressureMB + LF.WindsMPH,
                            data = hurricane_logdeaths) ;msummary(best_3pred_rank)

# so again, we drop wind speed as a predictor
drop.test(best_3pred_rank, best_2pred_rank)
```

NDAM2014 + LF.PressureMB


```{r}
# different models to predict log deaths using rfit
pressure_windspeed <- msummary(rfit(log_deaths ~ LF.PressureMB + LF.WindsMPH, 
                                  data = hurricane_logdeaths)) ;pressure_windspeed

pressure_ndam <- msummary(rfit(log_deaths ~ LF.PressureMB + NDAM2014, 
                                  data = hurricane_logdeaths)) ;pressure_ndam

pressure_basedam <- msummary(rfit(log_deaths ~ LF.PressureMB + BaseDam2014, 
                                  data = hurricane_logdeaths)) ;pressure_basedam

wind_basedam <- msummary(rfit(log_deaths ~ LF.WindsMPH + BaseDam2014, 
                            data = hurricane_logdeaths)) ;wind_basedam

wind_ndam <- msummary(rfit(log_deaths ~ LF.WindsMPH + NDAM2014, 
                            data = hurricane_logdeaths)) ;wind_ndam
```

JHM multiple regression OLIVER

## Generalized Additive Model
generalized additive model (which will require you attempting a variety of smoothers) ADI

```{r, warning=FALSE}
ndam_permutations <- c("1", "NDAM2014", "bs(NDAM2014)", "s(NDAM2014)")
pressure_permutations <- c("1", "LF.PressureMB", "bs(LF.PressureMB)", "s(LF.PressureMB)")
combined <- list(ndam_permutations, pressure_permutations)
two_pred_gam <- gam(log_deaths ~ NDAM2014 + LF.PressureMB, data=hurricane_logdeaths)

step.Gam(two_pred_gam, scope=combined)
```


## Results
table of aggregated results and discussion of findings

## Limitations
only data from US, small number of observations, small number of predictors for deaths

Potential shortcomings of the dataset include limited data on weather-related variables for each hurricane, as it only contains maximum sustained windspeed, atmospheric pressure at landfall, and number of landfalls. Additionally, the "NDAM2014" column contains data on hurricane damage had the hurricane appeared in 2014 and it is unclear how these estimates were calculated (also no units are given on these observations). 

## Conclusion









